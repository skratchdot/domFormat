<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>View Formatted Source - bookmarklet by skratchdot</title>
	<style type="text/css">
		html, body, h1, div {
			border: 0;
			margin: 0;
			padding: 0;
		}
		body {
			background: #000;
		}
		h1 {
			font-family: Georgia,"Palatino Linotype","Times New Roman",serif;
			padding: 10px;
			background: #ddd;
			clear: both;
			float: none;
		}
		a#home {
			color: #000;
			text-decoration: none;
		}
		a#home:hover {
			color: #c80000;			
		}
		h1 small {
			font-size: 12px;
		}
		h1 small a {
			color: #c80000;
			text-decoration: none;
		}
		h1 small a:hover {
			text-decoration: underline;
		}
		#copy-container {
			width: 32px;
			height: 32px;
			float: right;
			cursor: pointer;
			position: relative;
		}
		#copy {
			width: 32px;
			height: 32px;
		}
		#editor {
			position: relative;
		}
	</style>
</head>
<body>
	<h1 id="header">
		<a id="home" href="http://skratchdot.com/projects/domFormat/">domFormat</a>
		<small>
			bookmarklets:
			<a id="fn1" href="javascript:void(0);">View Source (pretty)</a>
			/
			<a id="fn2" href="javascript:void(0);">View Source (plain)</a>
			/
			<a id="fn3" href="javascript:void(0);">Reload Formatted</a>
		</small>
		<div id="copy-container">
			<img
				id="copy"
				src="http://skratchdot.github.com/domFormat/bookmarklet/copy.png"
				alt="Copy formatted source to clipboard"
				title="Copy formatted source to clipboard"
			/>
		</div>
	</h1>
	<div id="editor">
Install any of the 3 domFormat bookmarklets by dragging one of the
red links above to your bookmarks toolbar.  To use the bookmarklets,
visit any webpage, and click the link that you just saved.

## View Source (pretty) ##

    Displays the formatted HTML of any webpage, in an editor
    that looks exactly like this webpage. Includes a "copy" button
    in the top right corner that lets you copy all the contents of the
    editor with one click.

## View Source (plain) ##

    Displays the formatted HTML of any webpage in a &lt;textarea /&gt;.

## Reload Formatted ##

    Takes the formatted HTML of the current page, and reloads the page
    by using a document.write() statement.

## Credits ##

The following libaries were used in the building of these bookmarklets:

	- domFormat: https://github.com/skratchdot/domFormat/
	- CSS Beautify: https://github.com/senchalabs/cssbeautify/
	- JS Beautifier: https://github.com/einars/js-beautify/
	- ACE Editor: https://github.com/ajaxorg/ace/
	</div>
	<script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="http://skratchdot.github.com/domFormat/bookmarklet/ZeroClipboard.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		(function () {
			var elem = (document.compatMode === "CSS1Compat") ? document.documentElement : document.body,
				height = elem.clientHeight,
				header = document.getElementById('header'),
				editor = document.getElementById('editor'),
				copy = document.getElementById('copy'),
				clip, domString, getBookmarklet, fn1, fn2, fn3;

			// Make sure our "source" div fills the screen.  ACE editor doesn't allow percentages
			editor.style.height = (height - header.clientHeight) + 'px';

			// Now initialize our editor
			window.editor = ace.edit('editor');
			window.editor.setTheme('ace/theme/twilight');
			window.editor.getSession().setMode('ace/mode/html');

			// Add functionality to copy button
			ZeroClipboard.setMoviePath('http://skratchdot.github.com/domFormat/bookmarklet/ZeroClipboard.swf');
			clip = new ZeroClipboard.Client();
			clip.setText('');
			clip.glue('copy', 'copy-container');
			clip.addEventListener('onMouseDown', function () {
				clip.setText(window.editor.getValue());
			});
			clip.addEventListener('onComplete', function () {
				alert('The editor contents have been copied to your clipboard.');
				window.editor.focus();
			});

			// Populate editor with domFormat string if it exists
			if (window.localStorage) {
				domString = window.localStorage.getItem('DOMFORMAT');
				if (typeof domString === 'string' && domString.length > 0) {
					window.editor.setValue(domString);
					window.editor.clearSelection();
					window.localStorage.removeItem('DOMFORMAT');
				}
			}

			// Define bookmarklet 1
			fn1 = function (d,w) {
				var doc = d.cloneNode(true) || d,
					s = d.createElement('script');
				s.setAttribute('src', 'http://skratchdot.github.com/domFormat/domFormat.min.js');
				s.addEventListener('load', function() {
					var ds = domFormat.getString(doc);
					if (w.localStorage) {
						w.localStorage.setItem('DOMFORMAT', ds);
					} else {
						alert('Sorry. This bookmarklet only works on browsers that support localStorage.');
					}
					s = d.createElement('script');
					s.setAttribute('src', 'http://skratchdot.github.com/domFormat/bookmarklet/view-source.js');
					d.body.appendChild(s);
				}, false);
				d.body.appendChild(s);
			};

			// Define bookmarklet 2
			fn2 = function (d) {
				var doc = d.cloneNode(true) || d,
					s = d.createElement('script');
				s.setAttribute('src', 'http://skratchdot.github.com/domFormat/domFormat.min.js');
				s.addEventListener('load', function() {
					var ds = domFormat.getString(doc);
					d.open();
					d.write('<textarea wrap="off" id="s" style="width:100%;height:100%;border:0;margin:0;padding:0;whitespace:nowrap;"></textarea>');
					d.getElementById('s').value = ds;
					d.close();
				}, false);
				d.body.appendChild(s);
			};

			// Define bookmarklet 3
			fn3 = function (d) {
				var doc = d.cloneNode(true) || d,
					s = d.createElement('script');
				s.setAttribute('src', 'http://skratchdot.github.com/domFormat/domFormat.min.js');
				s.addEventListener('load', function() {
					var ds = domFormat.getString(doc);
					d.open();
					d.write(ds);
					d.close();
				}, false);
				d.body.appendChild(s);
			};

			// Helper function for removing whitespace from our bookmarklet code
			getBookmarklet = function (fnText, passWindow) {
				return 'javascript:(' +
					fnText.replace(/\s+/gi, ' ') +
					'(document' +
					(passWindow === true ? ',window' : '') +
					'));';
			};

			// Attach our bookmarklets to our anchor tags
			document.getElementById('fn1').href = getBookmarklet(fn1.toString(), true);
			document.getElementById('fn2').href = getBookmarklet(fn2.toString(), false);
			document.getElementById('fn3').href = getBookmarklet(fn3.toString(), false);
		}());
	</script>
</body>
</html>